| title       | tags          | background                                                   | auther | isSlow |
| ----------- | ------------- | ------------------------------------------------------------ | ------ | ------ |
| MySQL锁探究 | MySQL/锁/事务 | 最近在研究基于数据库实现分布式序列号生成方案时发现，自己对MySQL这块锁的理解还停留在理论和简单使用的层面，并没与在实践中充分的掌握这块知识点，所以这里专门开一篇文章来讨论这块内容。 | depers | true   |

# 分类

按表锁和行锁分类

* 表锁
    * **共享锁**
        * 加锁命令：`LOCK TABLES t READ`
    * **排他锁**
        * 加锁命令：`LOCK TABLES t WRITE`
    * **意向锁**
        * **意向共享锁**
        * **意向排他锁**
* 行锁
    * **记录锁**
        * 仅仅是将一条记录锁上，所以记录锁是**查询条件是添加了唯一索引或是主键索引的列**。
        * 共享锁
            * 加锁命令：`SELECT ... LOCK IN SHARE MODE;`
        * 排他锁
            * 加锁命令：`SELECT ... FOR UPDATE;`
    * **间隙锁**
        * 排他锁的一种。
        * 锁定一个范围但是不包含记录本身。
        * 仅在可重复读（Repeatable Read）隔离级别下有效。
        * 作用是解决幻读问题。
        * 在查询添加了索引的字段上。
        * 加锁命令：`SELECT * FROM products WHERE product_id BETWEEN 100 AND 200 FOR UPDATE;`
    * **临键锁**
        * 结合了记录锁（Record Lock）和间隙锁（Gap Lock）的一种锁机制。锁定的也是一个范围，包含记录本身。
        * 作用是解决幻读问题。
        * 在查询添加了索引的字段上。
        * 加锁命令：`SELECT * FROM users WHERE age >= 25 FOR UPDATE;`
    * 插入意向锁