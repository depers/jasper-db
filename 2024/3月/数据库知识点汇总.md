> 面试/数据库/MySQL

> 整理数据库相关的问题的汇总。

<div align=center><img src="../../assert/MySQL.png" style="zoom: 50%;" /></div>

1. 数据库设计的三大范式是什么？

2. MySQL使用**索引**查询数据库，最多会触达几次磁盘IO？

    在 MySQL 中，使用索引查询数据库时，最多会触达**两次磁盘 IO**。

    **第一次磁盘 IO 是在索引文件中查找符合查询条件的索引项**。索引文件通常是存储在磁盘上的 B 树结构，通过索引的有序性，可以快速定位到符合查询条件的索引项。

    **第二次磁盘 IO 是在数据文件中获取对应的数据行**。根据索引项中存储的指向数据行的指针，MySQL 可以直接定位到数据文件中的对应位置，读取所需的数据行。

3. MySQL使用**主键索引**查询数据库，会触发几次磁盘IO

    在 MySQL 中，如果使用主键索引查询数据库，通常最多会触达**一次磁盘IO**。

    当使用主键索引进行查询时，MySQL 会首先在索引树中查找符合查询条件的主键值。由于主键索引通常是有序的，并且存储了指向对应数据行的指针，因此可以通过索引快速定位到所需的数据行。

    一旦找到了匹配的主键值，MySQL 可以直接根据索引中存储的指针地址，从数据文件中读取对应的数据行，而无需再进行全表扫描或额外的磁盘IO操作。

    因此，使用主键索引查询数据库通常只需要一次磁盘IO操作来读取索引树和数据行。

4. MySQL中索引失效的原因有哪些？

    1. **`LIKE`以`%`或者`_`开头**，则不走索引。

    2. **`OR`语句前后没有同时使用索引**，当OR 左右查询字段只有一个是索引，该索引失效，只有当OR 左右查询字段均为索引时，才会生效。

    3. **联合索引没遵循最左匹配原则**。

    4. **索引列数据类型出现隐式转化**。

        varchar不加单引号的话可能会自动转换为int型，使索引无效，产生全表扫描。例如：tb1表中name字段是字符串类型

        ```sql
        索引失效：SELECT * FROM tb1 WHERE name = 123
        索引有效：SELECT * FROM tb1 WHERE name = '123'
        ```

    5. **对索引列进行计算或使用函数**。

        比如：

        ```sql
        SELECT * FROM t WHERE id*3=3000
        SELECT * FROM t WHERE ABS(id)=3000
        ```

    6. **ORDER BY使用错误**

        前提：假设建立索引`key a_b_c(a,b,c)`

        * `ORDER BY`的索引优化

            * `order by` 能使用最左前缀原则（以下四种情况索引生效）：

                - `order by a`

                - `order by a,b`

                - `order by a,b,c`

                - `order by a desc,b desc,c desc`

        * `WHERE` + `ORDER BY`的索引优化

            * 如果`where`+`order by`符合最左前缀原则，则索引生效
                - `where a=1 order by b,c`
                - `where a=1 and b=2 order by c`
                - `where a=1 and b>2 order b,c`

            * 以下情况索引失效：
                - `order by a asc,b desc,c desc`	// 排序不一致
                - `where d=1 order by b,c` 	           // 丢失a索引
                - `where a=1 order c `                              // 丢失b索引
                - `where a>1 order b,c`                          // 范围之后失效
                - `where a in (1,2,3..) order by b, c` // 范围查询之后失效

    7. **全表扫描速度比索引速度快**

        此时mysql会使用全表扫描，索引失效。例如：

        * 数据量极少的表

        * 表中索引字段数据重复率太高