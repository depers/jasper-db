> 系统设计/秒杀

>之前在面试的时候，老感觉自己没有做过什么复杂或是比较高级的系统和功能，所以最近专门找了一门秒杀系统的课程，系统的学习了一个完整的秒杀项目，这里通过这篇文章对这个系统中核心的功能做一个梳理和反思。

# 开源项目

项目源码地址：https://github.com/depers/miaosha

# 压测工具Jemeter的使用

### 1. 线程组

![](../../../jasper-db/assert/线程组.png)

* **线程数**：启动多少个线程去发起请求。
* **Ramp-Up时间**：在这个时间段内启动这些线程。
* **循环次数**：如果设置为10，线程数配置成10，意思就是说10个线程，每个线程调用请求10次，整体来说就是100次。

### 2. Http请求

在【线程组】-【添加】-【取样器】-【HTTP请求】新增一个Http请求的配置。这里要勾选【使用KeepAlive】从而**减少创建/关闭多个 TCP 连接的开销**，我们能够更好的测试我们接口本身的性能。

![](../../../jasper-db/assert/Http请求.png)

此外，还需要在这样页面的【高级】选项中，选择客户端的实现是【Java】，外面的Keepalive配置才能生效。

![](../../../jasper-db/assert/客户端的实现.png)

### 3. 查看结果树

用来查看每次请求的结果。

### 4. 聚合报告

用来查看请求的耗时的统计信息。其中【吞吐量】就是我们常说的TPS。

# 分布式扩展

## 1. 两条常用命令

### `pstree -p [pid] | wc -l`

上面这条命令用来统计应用进程开启的线程数。下面我们来具体看下这条命令各个参数的含义：

* `pstree -p [pid]`：

    * `pstree` 是一个命令，用于以树状结构显示进程之间的关系。

    * `-p` 选项表示显示进程的 PID。

    * `[pid]`是要查看其所属进程树的进程 ID。

* `|`这是一个管道符号，用于将`pstree`命令的输出传递给下一个命令。

* `wc -l`：

    * `wc` 是一个命令，用于统计文本的行数、单词数和字符数。

    * `-l`选项表示只统计行数。

### `top -H`

# 多级缓存

# 页面静态化

# 缓存库存

# 事务型消息保证最终一致性

# 流量削峰

# 防刷限流

# 参考文章

* [聚焦Java性能优化 打造亿级流量秒杀系统](https://coding.imooc.com/class/338.html)